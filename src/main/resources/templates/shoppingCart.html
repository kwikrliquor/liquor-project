<!DOCTYPE html>
<html  xmlns:th="http://www.thymeleaf.org"
       xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head th:replace="partials::head('Shopping Cart')"></head>
<body>
<div th:replace="partials::header"></div>
<div th:replace="partials::navbar"></div>
<main role="main" class="container">

    <div sec:authorize="!isAuthenticated()">
        <a href="/login"><h1 class="uk-text-large"> Please Login to View your Cart</h1></a>
    </div>

    <div sec:authorize="isAuthenticated()">
        <div tabindex="0" class="uk-child-width-1-2@s uk-child-width-1-3@m uk-grid uk-text-center" uk-scrollspy="cls: uk-animation-fade; target: > div > .uk-card; delay: 50; repeat: true">
            <div th:each="product : ${products.entrySet()}">
                <div class="uk-card uk-card-hover uk-card-body uk-margin-medium-bottom">
                    <h1 class="uk-card-title"><a th:text="${product.getKey().name}" th:href="@{'/products/' + ${product.getKey().id}}">Title</a></h1>
                    <hr class="uk-divider-icon" />
                    <p><em>Description</em></p>
                    <p th:text="${product.getKey().description}">Description</p>
                    <hr class="uk-divider-icon" />
                    <div th:inline="text" class="">Price: $[[${product.getKey().price}]] </div>
                    <div th:inline="text" class="">Quantity: [[${product.getValue()}]]</div>
                    <a th:href="@{'/shoppingCart/removeProduct/' + ${product.getKey().id}}" class="">
                        <button type="button" class="uk-button uk-button-default uk-button-small uk-border-rounded uk-margin-small-top" th:text="Remove">Remove</button>
                    </a>
                </div>
            </div>
            <div class="uk-grid uk-width-large-1-1 uk-visible-large uk-align-center">
                <input type="hidden" name="checkout_address" th:value="${order.id}"/>
                <input class="uk-input uk-border-rounded uk-width-medium checkout-box" id="checkout_address" name="checkout_address" type="text" />
                <h2 class="" th:inline="text">Total in cart: $[[${total}]]</h2>
                <br />
                <form th:action="@{'/shoppingCart/checkout'}" method="GET">
                    <script
                            th:method="POST"
                            src="https://checkout.stripe.com/checkout.js" class="stripe-button"
                            data-key="pk_test_TYooMQauvdEDq54NiTphI7jx"
                            th:attr="data-amount=${total_stripe}"
                            data-name="KWIKRLIQUOR"
                            data-description='Alcohol Delivery'
                            data-image="https://stripe.com/img/documentation/checkout/marketplace.png"
                            data-locale="auto"
                            data-zip-code="true">
                    </script>
                </form>
            </div>
        </div>
    </div>
</main><!-- /.container -->
<div th:replace="partials::footer"></div>
<div th:replace="partials::scripts"></div>

<script>
    function initAutocomplete() {
        // Create the autocomplete object, restricting the search to geographical
        // location types.
        autocomplete = new google.maps.places.Autocomplete(
            /** @type {!HTMLInputElement} */(document.getElementById('checkout_address')),
            {types: ['geocode']});
    }
</script>
</body>
</html>